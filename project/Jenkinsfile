#!/usr/bin/env groovy

pipeline {
    agent any
    
    stages{
        stage('Checking cft Installation') {
            steps {
                echo 'Checking CFT Version'
                sh 'cft -h'
            }
        }
        stage('Create Project') {
            environment {
                CFT_ORGANIZATION_FOLDER_ID = """${sh(
                        returnStdout: true,
                        script: 'cp /home/tomcat/cft-env-vars . && . ./cft-env-vars && echo $CFT_ORGANIZATION_FOLDER_ID'
                    )}""" 
                CFT_ORGANIZATION_ID = """${sh(
                        returnStdout: true,
                        script: 'cp /home/tomcat/cft-env-vars . && . ./cft-env-vars && echo $CFT_ORGANIZATION_ID'
                    )}""" 
                CFT_BILLING_ACCOUNT_ID = """${sh(
                        returnStdout: true,
                        script: 'cp /home/tomcat/cft-env-vars . && . ./cft-env-vars && echo $CFT_BILLING_ACCOUNT_ID'
                    )}""" 
                CFT_PIPELINE_DEPLOYER_ROLE = """${sh(
                        returnStdout: true,
                        script: 'cp /home/tomcat/cft-env-vars . && . ./cft-env-vars && echo $CFT_PIPELINE_DEPLOYER_ROLE'
                    )}""" 
            }
            steps {
                echo '------------------'
                sh 'printenv | grep CFT_'
                echo '------------------'
                sh 'cft project.yaml'
            }
        }
    }
}